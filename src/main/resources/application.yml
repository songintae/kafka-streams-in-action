spring:
  kafka:
    # Streams ????? bootstrap-servers ??? ?? ???? ?? spring.kafka.bootstrap-servers? ????.
    # https://docs.spring.io/spring-cloud-stream-binder-kafka/docs/3.2.1/reference/html/spring-cloud-stream-binder-kafka.html#_setting_up_bootstrap_server_configuration
    bootstrap-servers: localhost:9092
    producer:
      acks: 1
      batch-size: 1000000
      key-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      properties:
        linger.ms: 100

  # Multiple Kafka Streams processors? ??? ??? Application?? ?? ??? ???? ??? ??? ?????.
  # https://docs.spring.io/spring-cloud-stream-binder-kafka/docs/3.2.1/reference/html/spring-cloud-stream-binder-kafka.html#_multiple_kafka_streams_processors_within_a_single_application
  cloud:
    stream:
      function:
        definition: kafkaStreamsYellingApp;zMartStreamApplication
      bindings:
        # KafkaStreams Bindings inbound consumer에 useNativeDecoding을 사용할 때 주의해야한다.
        # useNativeDecoding 설정 또는 KStreamBoundElementFactory.createInput의 분기 전을 통해 useNativeDecoding이 결정되는데, default값은 true이다.
        # useNativeDecoding이 true일 경우 사용자가 선언한 valueSerde를 사용한다.
        # useNativeDecoding가 false 일 경우 Spring Cloud Stream에서 자동으로 Message를 Conversion을 해준다. (사용자가 입력한 valueSerde와 무관하게 Serde가 설정됨 -> 일반적인 JsonSerde는 지원)
        # 따라서 Topic ConsumerRecorde Deserialize 규칙에 따라 적절한 설정을 통해 설정을 해야한다.
        kafkaStreamsYellingApp-in-0:
          destination: src-topic
          consumer:
            concurrency: 1
        zMartStreamApplication-in-0:
          destination: transaction
          consumer:
            concurrency: 1
      kafka:
        streams:
          binder:
            functions:
              kafkaStreamsYellingApp:
                applicationId: kafkaStreamsYellingApp
              zMartStreamApplication:
                applicationId: zMartStreamApplication
            configuration:
              replication.factor: 3
              default:
                key.serde: org.springframework.kafka.support.serializer.JsonSerde
                # default.value.serde는 useNativeDecoding = true && Bindings에 valueSerde에 설정이 되어있지 않을 경우에만 동작한다
                value.serde: org.springframework.kafka.support.serializer.JsonSerde
          bindings:
            kafkaStreamsYellingApp-in-0:
              consumer:
                keySerde: org.apache.kafka.common.serialization.Serdes$StringSerde
                valueSerde: org.apache.kafka.common.serialization.Serdes$StringSerde
            zMartStreamApplication-in-0:
              consumer:
                keySerde: org.apache.kafka.common.serialization.Serdes$StringSerde
                valueSerde: com.example.kafkastreamsinaction.serde.PurchaseSerde

